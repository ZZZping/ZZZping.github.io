---
layout: post
title: SQL笔记
date: 2020-03-30 08:28:24.000000000 +09:00
---

# 数据库和SQL

# 擦寻基础

# 聚合与排序

## 对表进行聚合查询
   + COUNT:计算表中的行数
      1. 计算表中数据的行数
      ```
         SELECT COUNT(*)
         FROM Product;
      ```
      2. 计算NULL之外数据行数
         + 
         ```
            --计算purchase_prise中非空行个数
            SEELECT COUNT(pruchase_prise)
            FROM Product;
         ```
         + 
         ```
            --一张表中只含有NULL参数时，COUNT(*)和COUNT(col_1)的结果不一样，第一个结果为3，第二个结果为0
            SELECT COUNT(*), COUNT(col_1)
            FROM NullTab1;
         ```
   + SUM:计算表中数值列中数据的合计值
      1. 计算合计值
         + 
         ```
            --计算销售单价的合计值
            SELECT SUM(sale_price)
            FROM Product;
         ```
         + 
         ```
            --计算表中两列的合计值
            SELECT SUM(sale_price), SUM(purchase_price)
            FROM Product;
         ```
   + AVG:计算表中数值列中数据的平均值
      + 计算平均值
      ```
         SELECT AVG(sale_price)
         FROM Product;
      ```
      + 
      ```
         --计算含有NULL的平均值
         SELECT AVG(sale_price), AVG(purchase_price)
         FROM Product;
      ```
         + 当含有NULL值时，会先将NULL删除，在计算平均值，分母也会相应的减少NULL的数量
   + MAX:计算表中任意列中数据的最大值
      + 
      ```
         --计算最大值
         SELECT MAX(sale_price)
         FROM Product;
      ```
   + MIN:计算表中任意列中数据的最小值
      + 
      ```
         --计算最小值
         SELECT MIN(purchase_price)
         FROM Product;
      ```
   + 使用聚合函数删除重复值（DISTINCT关键字）
      + 
      ```
         SELECT COUNT(DISTINCT product_type)
         FROM Product;
      ```
      + DISTINCT删除product_type中的重复数据
   + 聚合函数会将NULL排除在外，但COUNT(*)例外，不会排除NULL
   + MAX/MIN与SUM/AVG函数不同，MAX/MIN函数适用于任何数据类型，SUM/AVG函数只能对数值类型列使用
   + 所有的聚合函数都可以使用DISTINCT关键字

## 对表进行分组
   + GROUP BY语句
      1. 
      ```
         --按照商品种类统计数据行数
         SELECT product_type, COUNT(*)
         FROM PRODUCT
         GROUP BY product_type;
      ```
      2. 使用WHERE时使用GROUP BY
      ```
         SELECT purchase_price, COUNT(*)
         FROM Product
         WHERE product_type = '衣服'
         GROUP BY purchase_price;
      ```

## 对聚合结果指定条件
   + HAVING语句
      + WHERE语句只能用来指定记录的条件，不能用来指定组的条件
         + WHERE子句 = 指定行对应的条件
      + HAVING语句可以用来对集合指定条件
         + HAVING子句 = 指定组对应的条件
   + HAVING语句要写在GROUP BY之后，在DBMS中的执行顺序也在GROUP BY之后
      + 
      ```
         --从按照商品种类进行分组后的结果中，取出“包含数据行数为2行”的组
         SELECT product_type, COUNT(*)
         FROM Product
         GROUP BY product_type
         HAVING COUNT(*) = 2;
      ```
      + 执行结果
      ![avatar](/assets/images/使用HAVING.png)
      <br>
      + 
      ```
         --不使用HAVING语句
         SELECT product_type, COUNT(*)
         FROM Product
         GROUP BY product;
      ```
      + 执行结果
      ![avatar](/assets/images/不使用HAVING.png)
      <br>
   + HAVING子句的构成要素
      1. 常数
      2. 聚合函数
      3. GROUP BY子句中指定的列名（即聚合键）
## 对查询结果进行安排
   + ORDER BY语句
      + 在SELECT语句末尾添加ORDER BY语句可以指定排序的顺序
      + 
      ```
         --按照销售单价由低到高排序
         SELECT product_id, product_name, sale_price, purchase_prise
         FROM Product
         ORDER BY sale_price;
      ```
      + 执行结果
      ![avatar](/assets/images/ORDER_BY_1.png)<br>
   + ORDER BY语句要写在SELECT语句末尾，因为对数据行进行排序的操作必须在结果即将返回时执行
   + 降序是在ORDER BY语句后加上DESC关键字
   + 
   ```
      --按照销售单价由低到高排序
      SELECT product_id, product_name, sale_price, purchase_prise
      FROM Product
      ORDER BY sale_price DESC;
   ```
   + 执行结果
   ![avatar](/assets/images/ORDER_BY_DESC.png)<br>
   + 使用升序排序时在ORDER BY末尾应该添加ASC关键字，但默认排序为升序
   + 指定多个排序键
      + 
      ```
         --按照销售单价和商品编号的升序进行排序
         SELECT product_id, product_name, sale_price, purchase_prise
         FROM Product
         ORDER BY sale_price, product_id;
      ```
      + 执行结果
      ![avatar](/assets/images/ORDER_BY_MANY.png)<br>
   + NULL的顺序
   ```
      --按照进货单价的升序进行排序
      SELECT product_id, product_name, sale_price, purchase_prise
      FROM Product
      ORDER BY purchase_price;
   ```
   + 执行结果
   ![avatar](/assets/images/ORDER_BY_NULL.png)<br>
      + 排序键中包含NULL时，会在开头或末尾进行汇总

# 数据更新

# 复杂查询

# 函数、谓词、case表达式

# 集合运算

# SQL高级处理

# 通过应用程序链接数据库

# 